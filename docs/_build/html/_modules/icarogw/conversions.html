<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>icarogw.conversions &mdash; icarogw 2.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            icarogw
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">icarogw</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">icarogw</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">icarogw.conversions</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for icarogw.conversions</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">.cupy_pal</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">healpy</span> <span class="k">as</span> <span class="nn">hp</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gaussian_kde</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">spence</span> <span class="k">as</span> <span class="n">PL</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<div class="viewcode-block" id="cartestianspins2chis"><a class="viewcode-back" href="../../icarogw.html#icarogw.conversions.cartestianspins2chis">[docs]</a><span class="k">def</span> <span class="nf">cartestianspins2chis</span><span class="p">(</span><span class="n">s1x</span><span class="p">,</span><span class="n">s1y</span><span class="p">,</span><span class="n">s1z</span><span class="p">,</span><span class="n">s2x</span><span class="p">,</span><span class="n">s2y</span><span class="p">,</span><span class="n">s2z</span><span class="p">,</span><span class="n">q</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns chi_1, chi_2, cosines with orbital angular momentum, chi_eff and chi_p </span>
<span class="sd">    from cartesian spin components (z is on the orbital angular momentum).</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s1x,s1y,s1z: xp.array</span>
<span class="sd">        Spin cartesian components of first object</span>
<span class="sd">    s2x,s2y,s2z: xp.array</span>
<span class="sd">        Spin cartesian components of secondary object</span>
<span class="sd">    q: xp.array</span>
<span class="sd">        mass ratio in (0,1]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">chi_1</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s1x</span><span class="o">**</span><span class="mf">2.</span><span class="o">+</span><span class="n">s1y</span><span class="o">**</span><span class="mf">2.</span><span class="o">+</span><span class="n">s1z</span><span class="o">**</span><span class="mf">2.</span><span class="p">)</span>
    <span class="n">chi_2</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s2x</span><span class="o">**</span><span class="mf">2.</span><span class="o">+</span><span class="n">s2y</span><span class="o">**</span><span class="mf">2.</span><span class="o">+</span><span class="n">s2z</span><span class="o">**</span><span class="mf">2.</span><span class="p">)</span>
    <span class="n">cos_t_1</span><span class="p">,</span> <span class="n">cos_t_2</span> <span class="o">=</span> <span class="n">s1z</span><span class="o">/</span><span class="n">chi_1</span> <span class="p">,</span> <span class="n">s2z</span><span class="o">/</span><span class="n">chi_2</span>
    <span class="n">chi_eff</span> <span class="o">=</span> <span class="n">chi_eff_from_spins</span><span class="p">(</span><span class="n">chi_1</span><span class="p">,</span> <span class="n">chi_2</span><span class="p">,</span> <span class="n">cos_t_1</span><span class="p">,</span> <span class="n">cos_t_2</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
    <span class="n">chi_p</span> <span class="o">=</span> <span class="n">chi_p_from_spins</span><span class="p">(</span><span class="n">chi_1</span><span class="p">,</span> <span class="n">chi_2</span><span class="p">,</span> <span class="n">cos_t_1</span><span class="p">,</span> <span class="n">cos_t_2</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">chi_1</span><span class="p">,</span> <span class="n">chi_2</span><span class="p">,</span> <span class="n">cos_t_1</span><span class="p">,</span> <span class="n">cos_t_2</span><span class="p">,</span> <span class="n">chi_eff</span><span class="p">,</span> <span class="n">chi_p</span></div>

<div class="viewcode-block" id="Di"><a class="viewcode-back" href="../../icarogw.html#icarogw.conversions.Di">[docs]</a><span class="k">def</span> <span class="nf">Di</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function from https://github.com/tcallister/effective-spin-priors. Credit: T. Callister</span>
<span class="sd">    Derivation of equations can be found in arxiv:2104.09508</span>
<span class="sd">    </span>
<span class="sd">    Wrapper for the scipy implmentation of Spence&#39;s function.</span>
<span class="sd">    Note that we adhere to the Mathematica convention as detailed in:</span>
<span class="sd">    https://reference.wolfram.com/language/ref/PolyLog.html</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    z: complex scalar or array</span>
<span class="sd">  </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        Array equivalent to PolyLog[2,z], as defined by Mathematica</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">return</span> <span class="n">PL</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">z</span><span class="o">+</span><span class="mi">0</span><span class="n">j</span><span class="p">)</span></div>

<div class="viewcode-block" id="chi_effective_prior_from_aligned_spins"><a class="viewcode-back" href="../../icarogw.html#icarogw.conversions.chi_effective_prior_from_aligned_spins">[docs]</a><span class="k">def</span> <span class="nf">chi_effective_prior_from_aligned_spins</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">aMax</span><span class="p">,</span><span class="n">xs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function from https://github.com/tcallister/effective-spin-priors. Credit: T. Callister</span>
<span class="sd">    Derivation of equations can be found in arxiv:2104.09508</span>
<span class="sd">    </span>
<span class="sd">    Function defining the conditional priors p(chi_eff|q) corresponding to</span>
<span class="sd">    uniform, aligned component spin priors.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q: np.array</span>
<span class="sd">        Mass ratio value (according to the convention q&lt;1)</span>
<span class="sd">    aMax: float</span>
<span class="sd">        Maximum allowed dimensionless component spin magnitude</span>
<span class="sd">    xs: np.array</span>
<span class="sd">        Chi_effective value or values at which we wish to compute prior</span>
<span class="sd">  </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Array of prior values</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Ensure that `xs` is an array and take Absolute bolometric value</span>
    <span class="n">origin_shape</span><span class="o">=</span><span class="n">xs</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Set up various piecewise cases</span>
    <span class="n">pdfs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
    <span class="n">caseA</span> <span class="o">=</span> <span class="p">(</span><span class="n">xs</span><span class="o">&gt;</span><span class="n">aMax</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">xs</span><span class="o">&lt;=</span><span class="n">aMax</span><span class="p">)</span>
    <span class="n">caseB</span> <span class="o">=</span> <span class="p">(</span><span class="n">xs</span><span class="o">&lt;-</span><span class="n">aMax</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">xs</span><span class="o">&gt;=-</span><span class="n">aMax</span><span class="p">)</span>
    <span class="n">caseC</span> <span class="o">=</span> <span class="p">(</span><span class="n">xs</span><span class="o">&gt;=-</span><span class="n">aMax</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">xs</span><span class="o">&lt;=</span><span class="n">aMax</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q</span><span class="p">))</span>

    <span class="c1"># Select relevant effective spins</span>
    <span class="n">x_A</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="n">caseA</span><span class="p">]</span>
    <span class="n">x_B</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="n">caseB</span><span class="p">]</span>
    <span class="n">x_C</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="n">caseC</span><span class="p">]</span>

    <span class="n">pdfs</span><span class="p">[</span><span class="n">caseA</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q</span><span class="p">[</span><span class="n">caseA</span><span class="p">])</span><span class="o">**</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">aMax</span><span class="o">-</span><span class="n">x_A</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">4.</span><span class="o">*</span><span class="n">q</span><span class="p">[</span><span class="n">caseA</span><span class="p">]</span><span class="o">*</span><span class="n">aMax</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">pdfs</span><span class="p">[</span><span class="n">caseB</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q</span><span class="p">[</span><span class="n">caseB</span><span class="p">])</span><span class="o">**</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">aMax</span><span class="o">+</span><span class="n">x_B</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">4.</span><span class="o">*</span><span class="n">q</span><span class="p">[</span><span class="n">caseB</span><span class="p">]</span><span class="o">*</span><span class="n">aMax</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">pdfs</span><span class="p">[</span><span class="n">caseC</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q</span><span class="p">[</span><span class="n">caseC</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">aMax</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pdfs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">origin_shape</span><span class="p">)</span></div>

<div class="viewcode-block" id="chi_effective_prior_from_isotropic_spins"><a class="viewcode-back" href="../../icarogw.html#icarogw.conversions.chi_effective_prior_from_isotropic_spins">[docs]</a><span class="k">def</span> <span class="nf">chi_effective_prior_from_isotropic_spins</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">aMax</span><span class="p">,</span><span class="n">xs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function from https://github.com/tcallister/effective-spin-priors. Credit: T. Callister</span>
<span class="sd">    Derivation of equations can be found in arxiv:2104.09508</span>
<span class="sd">    </span>
<span class="sd">    Note: small fix for q with respect to the original version. The original version was not selecting</span>
<span class="sd">    cases for q, this caused the code to crush when provided with q and xs arrays.</span>
<span class="sd">    </span>
<span class="sd">    Function defining the conditional priors p(chi_eff|q) corresponding to</span>
<span class="sd">    uniform, isotropic component spin priors.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q: np.array</span>
<span class="sd">        Mass ratio value (according to the convention q&lt;1)</span>
<span class="sd">    aMax: float</span>
<span class="sd">        Maximum allowed dimensionless component spin magnitude</span>
<span class="sd">    xs: np.array</span>
<span class="sd">        Chi_effective value or values at which we wish to compute prior</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Array of prior values</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Ensure that `xs` is an array and take Absolute bolometric value</span>
    <span class="n">origin_shape</span><span class="o">=</span><span class="n">xs</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xs</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Set up various piecewise cases</span>
    <span class="n">pdfs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
    <span class="n">caseZ</span> <span class="o">=</span> <span class="p">(</span><span class="n">xs</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">caseA</span> <span class="o">=</span> <span class="p">(</span><span class="n">xs</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">xs</span><span class="o">&lt;</span><span class="n">aMax</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">xs</span><span class="o">&lt;</span><span class="n">q</span><span class="o">*</span><span class="n">aMax</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q</span><span class="p">))</span>
    <span class="n">caseB</span> <span class="o">=</span> <span class="p">(</span><span class="n">xs</span><span class="o">&lt;</span><span class="n">aMax</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">xs</span><span class="o">&gt;</span><span class="n">q</span><span class="o">*</span><span class="n">aMax</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q</span><span class="p">))</span>
    <span class="n">caseC</span> <span class="o">=</span> <span class="p">(</span><span class="n">xs</span><span class="o">&gt;</span><span class="n">aMax</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">xs</span><span class="o">&lt;</span><span class="n">q</span><span class="o">*</span><span class="n">aMax</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q</span><span class="p">))</span>
    <span class="n">caseD</span> <span class="o">=</span> <span class="p">(</span><span class="n">xs</span><span class="o">&gt;</span><span class="n">aMax</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">xs</span><span class="o">&lt;</span><span class="n">aMax</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">xs</span><span class="o">&gt;=</span><span class="n">q</span><span class="o">*</span><span class="n">aMax</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q</span><span class="p">))</span>
    <span class="n">caseE</span> <span class="o">=</span> <span class="p">(</span><span class="n">xs</span><span class="o">&gt;</span><span class="n">aMax</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">xs</span><span class="o">&gt;</span><span class="n">aMax</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">xs</span><span class="o">&lt;</span><span class="n">aMax</span><span class="p">)</span>
    <span class="n">caseF</span> <span class="o">=</span> <span class="p">(</span><span class="n">xs</span><span class="o">&gt;=</span><span class="n">aMax</span><span class="p">)</span>

    <span class="c1"># Select relevant effective spins</span>
    <span class="n">x_A</span><span class="p">,</span> <span class="n">q_A</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="n">caseA</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="n">caseA</span><span class="p">]</span>
    <span class="n">x_B</span><span class="p">,</span> <span class="n">q_B</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="n">caseB</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="n">caseB</span><span class="p">]</span>
    <span class="n">x_C</span><span class="p">,</span> <span class="n">q_C</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="n">caseC</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="n">caseC</span><span class="p">]</span>
    <span class="n">x_D</span><span class="p">,</span> <span class="n">q_D</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="n">caseD</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="n">caseD</span><span class="p">]</span>
    <span class="n">x_E</span><span class="p">,</span> <span class="n">q_E</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="n">caseE</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="n">caseE</span><span class="p">]</span>
    <span class="n">q_Z</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">caseZ</span><span class="p">]</span>

    <span class="n">pdfs</span><span class="p">[</span><span class="n">caseZ</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_Z</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">aMax</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q_Z</span><span class="p">))</span>

    <span class="n">pdfs</span><span class="p">[</span><span class="n">caseA</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_A</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">4.</span><span class="o">*</span><span class="n">q_A</span><span class="o">*</span><span class="n">aMax</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span>
                    <span class="n">q_A</span><span class="o">*</span><span class="n">aMax</span><span class="o">*</span><span class="p">(</span><span class="mf">4.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">aMax</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q_A</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">aMax</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_A</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">x_A</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
                    <span class="o">-</span> <span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_A</span><span class="p">)</span><span class="o">*</span><span class="n">x_A</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctanh</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_A</span><span class="p">)</span><span class="o">*</span><span class="n">x_A</span><span class="o">/</span><span class="p">(</span><span class="n">q_A</span><span class="o">*</span><span class="n">aMax</span><span class="p">))</span>
                    <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_A</span><span class="p">)</span><span class="o">*</span><span class="n">x_A</span><span class="o">*</span><span class="p">(</span><span class="n">Di</span><span class="p">(</span><span class="o">-</span><span class="n">q_A</span><span class="o">*</span><span class="n">aMax</span><span class="o">/</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_A</span><span class="p">)</span><span class="o">*</span><span class="n">x_A</span><span class="p">))</span> <span class="o">-</span> <span class="n">Di</span><span class="p">(</span><span class="n">q_A</span><span class="o">*</span><span class="n">aMax</span><span class="o">/</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_A</span><span class="p">)</span><span class="o">*</span><span class="n">x_A</span><span class="p">)))</span>
                    <span class="p">)</span>

    <span class="n">pdfs</span><span class="p">[</span><span class="n">caseB</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_B</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">4.</span><span class="o">*</span><span class="n">q_B</span><span class="o">*</span><span class="n">aMax</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span>
                    <span class="mf">4.</span><span class="o">*</span><span class="n">q_B</span><span class="o">*</span><span class="n">aMax</span>
                    <span class="o">+</span> <span class="mf">2.</span><span class="o">*</span><span class="n">q_B</span><span class="o">*</span><span class="n">aMax</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">aMax</span><span class="p">)</span>
                    <span class="o">-</span> <span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_B</span><span class="p">)</span><span class="o">*</span><span class="n">x_B</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctanh</span><span class="p">(</span><span class="n">q_B</span><span class="o">*</span><span class="n">aMax</span><span class="o">/</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_B</span><span class="p">)</span><span class="o">*</span><span class="n">x_B</span><span class="p">))</span>
                    <span class="o">-</span> <span class="n">q_B</span><span class="o">*</span><span class="n">aMax</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_B</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">x_B</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">q_B</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">aMax</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_B</span><span class="p">)</span><span class="o">*</span><span class="n">x_B</span><span class="o">*</span><span class="p">(</span><span class="n">Di</span><span class="p">(</span><span class="o">-</span><span class="n">q_B</span><span class="o">*</span><span class="n">aMax</span><span class="o">/</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_B</span><span class="p">)</span><span class="o">*</span><span class="n">x_B</span><span class="p">))</span> <span class="o">-</span> <span class="n">Di</span><span class="p">(</span><span class="n">q_B</span><span class="o">*</span><span class="n">aMax</span><span class="o">/</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_B</span><span class="p">)</span><span class="o">*</span><span class="n">x_B</span><span class="p">)))</span>
                    <span class="p">)</span>

    <span class="n">pdfs</span><span class="p">[</span><span class="n">caseC</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_C</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">4.</span><span class="o">*</span><span class="n">q_C</span><span class="o">*</span><span class="n">aMax</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span>
                    <span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_C</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">aMax</span><span class="o">-</span><span class="n">x_C</span><span class="p">)</span>
                    <span class="o">-</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_C</span><span class="p">)</span><span class="o">*</span><span class="n">x_C</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">aMax</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">aMax</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_C</span><span class="p">)</span><span class="o">*</span><span class="n">x_C</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_C</span><span class="p">)</span><span class="o">*</span><span class="n">x_C</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q_C</span><span class="o">*</span><span class="n">aMax</span><span class="o">/</span><span class="p">(</span><span class="n">aMax</span><span class="o">-</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_C</span><span class="p">)</span><span class="o">*</span><span class="n">x_C</span><span class="p">))</span>
                    <span class="o">-</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_C</span><span class="p">)</span><span class="o">*</span><span class="n">x_C</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">aMax</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q_C</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">aMax</span><span class="o">-</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_C</span><span class="p">)</span><span class="o">*</span><span class="n">x_C</span><span class="p">))</span>
                    <span class="o">+</span> <span class="n">q_C</span><span class="o">*</span><span class="n">aMax</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">aMax</span><span class="o">/</span><span class="p">(</span><span class="n">q_C</span><span class="o">*</span><span class="n">aMax</span><span class="o">-</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_C</span><span class="p">)</span><span class="o">*</span><span class="n">x_C</span><span class="p">))</span>
                    <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_C</span><span class="p">)</span><span class="o">*</span><span class="n">x_C</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="n">aMax</span><span class="o">-</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_C</span><span class="p">)</span><span class="o">*</span><span class="n">x_C</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q_C</span><span class="o">*</span><span class="n">aMax</span><span class="o">-</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_C</span><span class="p">)</span><span class="o">*</span><span class="n">x_C</span><span class="p">)</span><span class="o">/</span><span class="n">q_C</span><span class="p">)</span>
                    <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_C</span><span class="p">)</span><span class="o">*</span><span class="n">x_C</span><span class="o">*</span><span class="p">(</span><span class="n">Di</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">aMax</span><span class="o">/</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_C</span><span class="p">)</span><span class="o">*</span><span class="n">x_C</span><span class="p">))</span> <span class="o">-</span> <span class="n">Di</span><span class="p">(</span><span class="n">q_C</span><span class="o">*</span><span class="n">aMax</span><span class="o">/</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_C</span><span class="p">)</span><span class="o">*</span><span class="n">x_C</span><span class="p">)))</span>
                    <span class="p">)</span>

    <span class="n">pdfs</span><span class="p">[</span><span class="n">caseD</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_D</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">4.</span><span class="o">*</span><span class="n">q_D</span><span class="o">*</span><span class="n">aMax</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span>
                    <span class="o">-</span><span class="n">x_D</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">aMax</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
                    <span class="o">+</span> <span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_D</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">aMax</span><span class="o">-</span><span class="n">x_D</span><span class="p">)</span>
                    <span class="o">+</span> <span class="n">q_D</span><span class="o">*</span><span class="n">aMax</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">aMax</span><span class="o">/</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_D</span><span class="p">)</span><span class="o">*</span><span class="n">x_D</span><span class="o">-</span><span class="n">q_D</span><span class="o">*</span><span class="n">aMax</span><span class="p">))</span>
                    <span class="o">+</span> <span class="n">aMax</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q_D</span><span class="o">*</span><span class="n">aMax</span><span class="o">/</span><span class="p">(</span><span class="n">aMax</span><span class="o">-</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_D</span><span class="p">)</span><span class="o">*</span><span class="n">x_D</span><span class="p">))</span>
                    <span class="o">-</span> <span class="n">x_D</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">aMax</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_D</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_D</span><span class="p">)</span><span class="o">*</span><span class="n">x_D</span><span class="p">)</span> <span class="o">-</span> <span class="n">q_D</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_D</span><span class="p">)</span><span class="o">*</span><span class="n">x_D</span><span class="o">/</span><span class="n">aMax</span><span class="p">))</span>
                    <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_D</span><span class="p">)</span><span class="o">*</span><span class="n">x_D</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="o">-</span><span class="n">q_D</span><span class="o">*</span><span class="n">aMax</span><span class="o">+</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_D</span><span class="p">)</span><span class="o">*</span><span class="n">x_D</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">aMax</span><span class="o">-</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_D</span><span class="p">)</span><span class="o">*</span><span class="n">x_D</span><span class="p">)</span><span class="o">/</span><span class="n">q_D</span><span class="p">)</span>
                    <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_D</span><span class="p">)</span><span class="o">*</span><span class="n">x_D</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">aMax</span><span class="o">/</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_D</span><span class="p">)</span><span class="o">*</span><span class="n">x_D</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="n">aMax</span><span class="o">-</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_D</span><span class="p">)</span><span class="o">*</span><span class="n">x_D</span><span class="p">)</span><span class="o">/</span><span class="n">q_D</span><span class="p">)</span>
                    <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_D</span><span class="p">)</span><span class="o">*</span><span class="n">x_D</span><span class="o">*</span><span class="p">(</span><span class="n">Di</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">aMax</span><span class="o">/</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_D</span><span class="p">)</span><span class="o">*</span><span class="n">x_D</span><span class="p">))</span> <span class="o">-</span> <span class="n">Di</span><span class="p">(</span><span class="n">q_D</span><span class="o">*</span><span class="n">aMax</span><span class="o">/</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_D</span><span class="p">)</span><span class="o">*</span><span class="n">x_D</span><span class="p">)))</span>
                    <span class="p">)</span>

    <span class="n">pdfs</span><span class="p">[</span><span class="n">caseE</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_E</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">4.</span><span class="o">*</span><span class="n">q_E</span><span class="o">*</span><span class="n">aMax</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span>
                    <span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_E</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">aMax</span><span class="o">-</span><span class="n">x_E</span><span class="p">)</span>
                    <span class="o">-</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_E</span><span class="p">)</span><span class="o">*</span><span class="n">x_E</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">aMax</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
                    <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">aMax</span><span class="p">)</span><span class="o">*</span><span class="p">(</span>
                        <span class="n">aMax</span>
                        <span class="o">-</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_E</span><span class="p">)</span><span class="o">*</span><span class="n">x_E</span>
                        <span class="o">-</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_E</span><span class="p">)</span><span class="o">*</span><span class="n">x_E</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q_E</span><span class="o">/</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_E</span><span class="p">)</span><span class="o">*</span><span class="n">x_E</span><span class="o">-</span><span class="n">aMax</span><span class="p">))</span>
                        <span class="p">)</span>
                    <span class="o">-</span> <span class="n">aMax</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_E</span><span class="p">)</span><span class="o">*</span><span class="n">x_E</span><span class="o">-</span><span class="n">aMax</span><span class="p">)</span><span class="o">/</span><span class="n">q_E</span><span class="p">)</span>
                    <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_E</span><span class="p">)</span><span class="o">*</span><span class="n">x_E</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_E</span><span class="p">)</span><span class="o">*</span><span class="n">x_E</span><span class="o">-</span><span class="n">aMax</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_E</span><span class="p">)</span><span class="o">*</span><span class="n">x_E</span><span class="o">-</span><span class="n">q_E</span><span class="o">*</span><span class="n">aMax</span><span class="p">)</span><span class="o">/</span><span class="n">q_E</span><span class="p">)</span>
                    <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_E</span><span class="p">)</span><span class="o">*</span><span class="n">x_E</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_E</span><span class="p">)</span><span class="o">*</span><span class="n">x_E</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q_E</span><span class="o">*</span><span class="n">aMax</span><span class="o">/</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_E</span><span class="p">)</span><span class="o">*</span><span class="n">x_E</span><span class="o">-</span><span class="n">aMax</span><span class="p">))</span>
                    <span class="o">-</span> <span class="n">q_E</span><span class="o">*</span><span class="n">aMax</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_E</span><span class="p">)</span><span class="o">*</span><span class="n">x_E</span><span class="o">-</span><span class="n">q_E</span><span class="o">*</span><span class="n">aMax</span><span class="p">)</span><span class="o">/</span><span class="n">aMax</span><span class="p">)</span>
                    <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_E</span><span class="p">)</span><span class="o">*</span><span class="n">x_E</span><span class="o">*</span><span class="p">(</span><span class="n">Di</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">aMax</span><span class="o">/</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_E</span><span class="p">)</span><span class="o">*</span><span class="n">x_E</span><span class="p">))</span> <span class="o">-</span> <span class="n">Di</span><span class="p">(</span><span class="n">q_E</span><span class="o">*</span><span class="n">aMax</span><span class="o">/</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q_E</span><span class="p">)</span><span class="o">*</span><span class="n">x_E</span><span class="p">)))</span>
                    <span class="p">)</span>

    <span class="n">pdfs</span><span class="p">[</span><span class="n">caseF</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>

    <span class="c1"># Deal with spins on the boundary between cases</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">pdfs</span><span class="o">==-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">boundary</span> <span class="o">=</span> <span class="p">(</span><span class="n">pdfs</span><span class="o">==-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pdfs</span><span class="p">[</span><span class="n">boundary</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">chi_effective_prior_from_isotropic_spins</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">boundary</span><span class="p">],</span><span class="n">aMax</span><span class="p">,</span><span class="n">xs</span><span class="p">[</span><span class="n">boundary</span><span class="p">]</span><span class="o">+</span><span class="mf">1e-6</span><span class="p">)</span>\
                        <span class="o">+</span> <span class="n">chi_effective_prior_from_isotropic_spins</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">boundary</span><span class="p">],</span><span class="n">aMax</span><span class="p">,</span><span class="n">xs</span><span class="p">[</span><span class="n">boundary</span><span class="p">]</span><span class="o">-</span><span class="mf">1e-6</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">pdfs</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">origin_shape</span><span class="p">)</span></div>

<div class="viewcode-block" id="chi_p_prior_from_isotropic_spins"><a class="viewcode-back" href="../../icarogw.html#icarogw.conversions.chi_p_prior_from_isotropic_spins">[docs]</a><span class="k">def</span> <span class="nf">chi_p_prior_from_isotropic_spins</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">aMax</span><span class="p">,</span><span class="n">xs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function from https://github.com/tcallister/effective-spin-priors. Credit: T. Callister</span>
<span class="sd">    Derivation of equations can be found in arxiv:2104.09508</span>
<span class="sd">    </span>
<span class="sd">    Function defining the conditional priors p(chi_p|q) corresponding to</span>
<span class="sd">    uniform, isotropic component spin priors.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q: np.array</span>
<span class="sd">        Mass ratio value (according to the convention q&lt;1)</span>
<span class="sd">    aMax: float</span>
<span class="sd">        Maximum allowed dimensionless component spin magnitude</span>
<span class="sd">    xs: np.arry</span>
<span class="sd">        Chi_p value or values at which we wish to compute prior</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    Array of prior values</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Ensure that `xs` is an array and take Absolute bolometric value</span>
    <span class="n">origin_shape</span><span class="o">=</span><span class="n">xs</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Set up various piecewise cases</span>
    <span class="n">pdfs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
    <span class="n">caseA</span> <span class="o">=</span> <span class="n">xs</span><span class="o">&lt;</span><span class="n">q</span><span class="o">*</span><span class="n">aMax</span><span class="o">*</span><span class="p">(</span><span class="mf">3.</span><span class="o">+</span><span class="mf">4.</span><span class="o">*</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">4.</span><span class="o">+</span><span class="mf">3.</span><span class="o">*</span><span class="n">q</span><span class="p">)</span>
    <span class="n">caseB</span> <span class="o">=</span> <span class="p">(</span><span class="n">xs</span><span class="o">&gt;=</span><span class="n">q</span><span class="o">*</span><span class="n">aMax</span><span class="o">*</span><span class="p">(</span><span class="mf">3.</span><span class="o">+</span><span class="mf">4.</span><span class="o">*</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">4.</span><span class="o">+</span><span class="mf">3.</span><span class="o">*</span><span class="n">q</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">xs</span><span class="o">&lt;</span><span class="n">aMax</span><span class="p">)</span>

    <span class="c1"># Select relevant effective spins</span>
    <span class="n">x_A</span><span class="p">,</span> <span class="n">q_A</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="n">caseA</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="n">caseA</span><span class="p">]</span>
    <span class="n">x_B</span><span class="p">,</span> <span class="n">q_B</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="n">caseB</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="n">caseB</span><span class="p">]</span>

    <span class="n">pdfs</span><span class="p">[</span><span class="n">caseA</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">aMax</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">q_A</span><span class="p">))</span><span class="o">*</span><span class="p">((</span><span class="mf">4.</span><span class="o">+</span><span class="mf">3.</span><span class="o">*</span><span class="n">q_A</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">3.</span><span class="o">+</span><span class="mf">4.</span><span class="o">*</span><span class="n">q_A</span><span class="p">))</span><span class="o">*</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">((</span><span class="mf">4.</span><span class="o">+</span><span class="mf">3.</span><span class="o">*</span><span class="n">q_A</span><span class="p">)</span><span class="o">*</span><span class="n">x_A</span><span class="o">/</span><span class="p">((</span><span class="mf">3.</span><span class="o">+</span><span class="mf">4.</span><span class="o">*</span><span class="n">q_A</span><span class="p">)</span><span class="o">*</span><span class="n">q</span><span class="o">*</span><span class="n">aMax</span><span class="p">))</span><span class="o">*</span><span class="p">(</span>
                        <span class="n">aMax</span>
                        <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">aMax</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">x_A</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                        <span class="o">+</span> <span class="n">x_A</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">x_A</span><span class="o">/</span><span class="n">aMax</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">x_A</span><span class="o">/</span><span class="n">aMax</span><span class="p">)</span><span class="o">*</span><span class="p">(</span>
                        <span class="n">aMax</span><span class="o">*</span><span class="n">q_A</span><span class="o">*</span><span class="p">(</span><span class="mf">3.</span><span class="o">+</span><span class="mf">4.</span><span class="o">*</span><span class="n">q_A</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">4.</span><span class="o">+</span><span class="mf">3.</span><span class="o">*</span><span class="n">q_A</span><span class="p">)</span>
                        <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">aMax</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">q_A</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">((</span><span class="mf">3.</span><span class="o">+</span><span class="mf">4.</span><span class="o">*</span><span class="n">q_A</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">4.</span><span class="o">+</span><span class="mf">3.</span><span class="o">*</span><span class="n">q_A</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">x_A</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                        <span class="o">+</span> <span class="n">x_A</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">((</span><span class="mf">4.</span><span class="o">+</span><span class="mf">3.</span><span class="o">*</span><span class="n">q_A</span><span class="p">)</span><span class="o">*</span><span class="n">x_A</span><span class="o">/</span><span class="p">((</span><span class="mf">3.</span><span class="o">+</span><span class="mf">4.</span><span class="o">*</span><span class="n">q_A</span><span class="p">)</span><span class="o">*</span><span class="n">aMax</span><span class="o">*</span><span class="n">q_A</span><span class="p">))</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

    <span class="n">pdfs</span><span class="p">[</span><span class="n">caseB</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">aMax</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">x_B</span><span class="o">/</span><span class="n">aMax</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pdfs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">origin_shape</span><span class="p">)</span></div>

<div class="viewcode-block" id="joint_prior_from_isotropic_spins"><a class="viewcode-back" href="../../icarogw.html#icarogw.conversions.joint_prior_from_isotropic_spins">[docs]</a><span class="k">def</span> <span class="nf">joint_prior_from_isotropic_spins</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">aMax</span><span class="p">,</span><span class="n">xeffs</span><span class="p">,</span><span class="n">xps</span><span class="p">,</span><span class="n">ndraws</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span><span class="n">bw_method</span><span class="o">=</span><span class="s1">&#39;scott&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function from https://github.com/tcallister/effective-spin-priors. Credit: T. Callister</span>
<span class="sd">    Derivation of equations can be found in arxiv:2104.09508</span>
<span class="sd">    </span>
<span class="sd">    Function to calculate the conditional priors p(xp|xeff,q) on a set of {xp,xeff,q} posterior samples.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q: np.array</span>
<span class="sd">        Mass ratio</span>
<span class="sd">    aMax: float</span>
<span class="sd">        Maximimum spin magnitude considered</span>
<span class="sd">    xeffs: np.array</span>
<span class="sd">        Effective inspiral spin samples</span>
<span class="sd">    xps: np.array</span>
<span class="sd">        Effective precessing spin values</span>
<span class="sd">    ndraws: int</span>
<span class="sd">        Number of draws from the component spin priors used in numerically building interpolant</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    </span>
<span class="sd">    Array of priors on xp, conditioned on given effective inspiral spins and mass ratios</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Convert to arrays for safety</span>
    <span class="n">origin_shape</span><span class="o">=</span><span class="n">xeffs</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">xeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xeffs</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">xps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xps</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Compute marginal prior on xeff, conditional prior on xp, and multiply to get joint prior!</span>
    <span class="n">p_chi_eff</span> <span class="o">=</span> <span class="n">chi_effective_prior_from_isotropic_spins</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">aMax</span><span class="p">,</span><span class="n">xeffs</span><span class="p">)</span>
    <span class="n">p_chi_p_given_chi_eff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p_chi_eff</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p_chi_eff</span><span class="p">)),</span><span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Calculating p(chi_p|chi_eff,q)&#39;</span><span class="p">):</span>
        <span class="n">p_chi_p_given_chi_eff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">chi_p_prior_given_chi_eff_q</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">aMax</span><span class="p">,</span><span class="n">xeffs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">xps</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">ndraws</span><span class="p">,</span><span class="n">bw_method</span><span class="p">)</span>
    <span class="n">joint_p_chi_p_chi_eff</span> <span class="o">=</span> <span class="n">p_chi_eff</span><span class="o">*</span><span class="n">p_chi_p_given_chi_eff</span>

    <span class="k">return</span> <span class="n">joint_p_chi_p_chi_eff</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">origin_shape</span><span class="p">)</span></div>

<div class="viewcode-block" id="chi_p_prior_given_chi_eff_q"><a class="viewcode-back" href="../../icarogw.html#icarogw.conversions.chi_p_prior_given_chi_eff_q">[docs]</a><span class="k">def</span> <span class="nf">chi_p_prior_given_chi_eff_q</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">aMax</span><span class="p">,</span><span class="n">xeff</span><span class="p">,</span><span class="n">xp</span><span class="p">,</span><span class="n">ndraws</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span><span class="n">bw_method</span><span class="o">=</span><span class="s1">&#39;scott&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function from https://github.com/tcallister/effective-spin-priors. Credit: T. Callister</span>
<span class="sd">    Derivation of equations can be found in arxiv:2104.09508</span>
<span class="sd">    </span>
<span class="sd">    Function to calculate the conditional prior p(xp|xeff,q) on a single {xp,xeff,q} posterior sample.</span>
<span class="sd">    Called by `joint_prior_from_isotropic_spins`.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q: np.array</span>
<span class="sd">        Single posterior mass ratio sample</span>
<span class="sd">    aMax: float</span>
<span class="sd">        Maximimum spin magnitude considered</span>
<span class="sd">    xeff: np.array</span>
<span class="sd">        Single effective inspiral spin sample</span>
<span class="sd">    xp: np.array</span>
<span class="sd">        Single effective precessing spin value</span>
<span class="sd">    ndraws: int</span>
<span class="sd">        Number of draws from the component spin priors used in numerically building interpolant</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Prior on xp, conditioned on given effective inspiral spin and mass ratio</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Draw random spin magnitudes.</span>
    <span class="c1"># Note that, given a fixed chi_eff, a1 can be no larger than (1+q)*chi_eff,</span>
    <span class="c1"># and a2 can be no larger than (1+q)*chi_eff/q</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">ndraws</span><span class="p">)</span><span class="o">*</span><span class="n">aMax</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">ndraws</span><span class="p">)</span><span class="o">*</span><span class="n">aMax</span>

    <span class="c1"># Draw random tilts for spin 2</span>
    <span class="n">cost2</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">ndraws</span><span class="p">)</span><span class="o">-</span><span class="mf">1.</span>

    <span class="c1"># Finally, given our conditional value for chi_eff, we can solve for cost1</span>
    <span class="c1"># Note, though, that we still must require that the implied value of cost1 be *physical*</span>
    <span class="n">cost1</span> <span class="o">=</span> <span class="p">(</span><span class="n">xeff</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="n">q</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">cost2</span><span class="p">)</span><span class="o">/</span><span class="n">a1</span>

    <span class="c1"># While any cost1 values remain unphysical, redraw a1, a2, and cost2, and recompute</span>
    <span class="c1"># Repeat as necessary</span>
    <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">cost1</span><span class="o">&lt;-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">cost1</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">to_replace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">cost1</span><span class="o">&lt;-</span><span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">cost1</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">a1</span><span class="p">[</span><span class="n">to_replace</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">to_replace</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">*</span><span class="n">aMax</span>
        <span class="n">a2</span><span class="p">[</span><span class="n">to_replace</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">to_replace</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">*</span><span class="n">aMax</span>
        <span class="n">cost2</span><span class="p">[</span><span class="n">to_replace</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">to_replace</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">-</span><span class="mf">1.</span>
        <span class="n">cost1</span> <span class="o">=</span> <span class="p">(</span><span class="n">xeff</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="n">q</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">cost2</span><span class="p">)</span><span class="o">/</span><span class="n">a1</span>

    <span class="c1"># Compute precessing spins and corresponding weights, build KDE</span>
    <span class="c1"># See `Joint-ChiEff-ChiP-Prior.ipynb` for a discussion of these weights</span>
    <span class="n">Xp_draws</span> <span class="o">=</span> <span class="n">chi_p_from_spins</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">cost1</span><span class="p">,</span><span class="n">cost2</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
    <span class="n">jacobian_weights</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="n">a1</span>
    <span class="n">prior_kde</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">Xp_draws</span><span class="p">,</span><span class="n">weights</span><span class="o">=</span><span class="n">jacobian_weights</span><span class="p">,</span><span class="n">bw_method</span><span class="o">=</span><span class="n">bw_method</span><span class="p">)</span>

    <span class="c1"># Compute maximum chi_p</span>
    <span class="k">if</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xeff</span><span class="p">)</span><span class="o">/</span><span class="n">q</span><span class="o">&lt;</span><span class="n">aMax</span><span class="p">:</span>
        <span class="n">max_Xp</span> <span class="o">=</span> <span class="n">aMax</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">max_Xp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">aMax</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="n">q</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xeff</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span><span class="p">)</span>

    <span class="c1"># Set up a grid slightly inside (0,max chi_p) and evaluate KDE</span>
    <span class="n">reference_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.05</span><span class="o">*</span><span class="n">max_Xp</span><span class="p">,</span><span class="mf">0.95</span><span class="o">*</span><span class="n">max_Xp</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">reference_vals</span> <span class="o">=</span> <span class="n">prior_kde</span><span class="p">(</span><span class="n">reference_grid</span><span class="p">)</span>

    <span class="c1"># Manually prepend/append zeros at the boundaries</span>
    <span class="n">reference_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="mi">0</span><span class="p">],</span><span class="n">reference_grid</span><span class="p">,[</span><span class="n">max_Xp</span><span class="p">]])</span>
    <span class="n">reference_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="mi">0</span><span class="p">],</span><span class="n">reference_vals</span><span class="p">,[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">norm_constant</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">reference_vals</span><span class="p">,</span><span class="n">reference_grid</span><span class="p">)</span>

    <span class="c1"># Interpolate!</span>
    <span class="n">p_chi_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span><span class="n">reference_grid</span><span class="p">,</span><span class="n">reference_vals</span><span class="o">/</span><span class="n">norm_constant</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p_chi_p</span></div>

<div class="viewcode-block" id="chi_eff_from_spins"><a class="viewcode-back" href="../../icarogw.html#icarogw.conversions.chi_eff_from_spins">[docs]</a><span class="k">def</span> <span class="nf">chi_eff_from_spins</span><span class="p">(</span><span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">cos1</span><span class="p">,</span> <span class="n">cos2</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to tranform the usual spins parameters chi, chi2, cos1, cos2</span>
<span class="sd">    into the the effective spin parameters chi_eff.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    chi1: primary dimensionless spin magnitude</span>
<span class="sd">    chi2: secondary spin magnitude</span>
<span class="sd">    cos1: cosine of the primary tilt angle</span>
<span class="sd">    cos2: cosine of the secondary tilt angle</span>
<span class="sd">    q: mass ratio   \propto (m2/m1)</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    chi effective</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">to_ret</span> <span class="o">=</span> <span class="p">(</span><span class="n">chi1</span><span class="o">*</span><span class="n">cos1</span> <span class="o">+</span> <span class="n">q</span><span class="o">*</span><span class="n">chi2</span><span class="o">*</span><span class="n">cos2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">to_ret</span></div>

<div class="viewcode-block" id="chi_p_from_spins"><a class="viewcode-back" href="../../icarogw.html#icarogw.conversions.chi_p_from_spins">[docs]</a><span class="k">def</span> <span class="nf">chi_p_from_spins</span><span class="p">(</span><span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">cos1</span><span class="p">,</span> <span class="n">cos2</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to tranform the usual spins parameters chi, chi2, cos1, cos2</span>
<span class="sd">    into the the precessing spin parameters  chi_p</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    chi1: primary dimensionless spin magnitude</span>
<span class="sd">    chi2: secondary spin magnitude</span>
<span class="sd">    cos1: cosine of the primary tilt angle</span>
<span class="sd">    cos2: cosine of the secondary tilt angle</span>
<span class="sd">    q: mass ratio   \propto (m2/m1)</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    chi p</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">sin1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">cos1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">sin2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">cos2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">to_ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">chi1</span><span class="o">*</span><span class="n">sin1</span><span class="p">,</span> <span class="p">((</span><span class="mi">4</span><span class="o">*</span><span class="n">q</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">q</span><span class="o">+</span><span class="mi">4</span><span class="p">))</span><span class="o">*</span><span class="n">q</span><span class="o">*</span><span class="n">chi2</span><span class="o">*</span><span class="n">sin2</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">to_ret</span></div>

<div class="viewcode-block" id="radec2skymap"><a class="viewcode-back" href="../../icarogw.html#icarogw.conversions.radec2skymap">[docs]</a><span class="k">def</span> <span class="nf">radec2skymap</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span><span class="n">dec</span><span class="p">,</span><span class="n">nside</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts RA and DEC samples to a skymap with normalized probability, i.e. integral of skymap in dArea =1</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ra, dec: np.array</span>
<span class="sd">        arrays with RA and DEC in radians</span>
<span class="sd">    nside: int</span>
<span class="sd">        nside for healpy</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    counts_maps: np.array</span>
<span class="sd">        Healpy array with skymap</span>
<span class="sd">    dOmega_sterad: float</span>
<span class="sd">        Area in steradians of the sky cell</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">npixels</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">nside2npix</span><span class="p">(</span><span class="n">nside</span><span class="p">)</span>
    <span class="n">dOmega_sterad</span><span class="o">=</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">npixels</span>
    <span class="n">dOmega_deg2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">xp</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="n">dOmega_sterad</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">radec2indeces</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span><span class="n">dec</span><span class="p">,</span><span class="n">nside</span><span class="p">)</span>
    <span class="n">counts_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npixels</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">indx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npixels</span><span class="p">):</span>
        <span class="n">ind</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">indices</span><span class="o">==</span><span class="n">indx</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">counts_map</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ind</span><span class="o">.</span><span class="n">size</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
    <span class="n">counts_map</span><span class="o">/=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span><span class="o">*</span><span class="n">dOmega_sterad</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">counts_map</span><span class="p">,</span> <span class="n">dOmega_sterad</span></div>


<div class="viewcode-block" id="L2M"><a class="viewcode-back" href="../../icarogw.html#icarogw.conversions.L2M">[docs]</a><span class="k">def</span> <span class="nf">L2M</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts Luminosity in Watt to Absolute bolometric magnitude</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    L: xp.array</span>
<span class="sd">        Luminosity in Watt</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    M: xp.array</span>
<span class="sd">        Absolute bolometric magnitude</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># From Resolution B2 proposed by IAU, see e.g. Pag. 2, Eq. 2 of https://www.iau.org/static/resolutions/IAU2015_English.pdf</span>
    <span class="k">return</span> <span class="o">-</span><span class="mf">2.5</span><span class="o">*</span><span class="n">xp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">L</span><span class="p">)</span><span class="o">+</span><span class="mf">71.197425</span></div>

<div class="viewcode-block" id="M2L"><a class="viewcode-back" href="../../icarogw.html#icarogw.conversions.M2L">[docs]</a><span class="k">def</span> <span class="nf">M2L</span><span class="p">(</span><span class="n">M</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts Absolute bolometric magnitude to Luminosity in Watt </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    M: xp.array</span>
<span class="sd">        Absolute bolometric magnitude</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    L: xp.array</span>
<span class="sd">        Luminosity in Watt</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># From Pag. 2, Eq. 1-2 of https://www.iau.org/static/resolutions/IAU2015_English.pdf</span>
    <span class="k">return</span> <span class="mf">3.0128e28</span><span class="o">*</span><span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="o">-</span><span class="mf">0.4</span><span class="o">*</span><span class="n">M</span><span class="p">)</span></div>

<div class="viewcode-block" id="radec2indeces"><a class="viewcode-back" href="../../icarogw.html#icarogw.conversions.radec2indeces">[docs]</a><span class="k">def</span> <span class="nf">radec2indeces</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span><span class="n">dec</span><span class="p">,</span><span class="n">nside</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts RA and DEC to healpy indeces</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ra, dec: np.array</span>
<span class="sd">        arrays with RA and DEC in radians</span>
<span class="sd">    nside: int</span>
<span class="sd">        nside for healpy</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    healpy indeces as numpy array</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">dec</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">ra</span>
    <span class="k">return</span> <span class="n">hp</span><span class="o">.</span><span class="n">ang2pix</span><span class="p">(</span><span class="n">nside</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span></div>

<div class="viewcode-block" id="indices2radec"><a class="viewcode-back" href="../../icarogw.html#icarogw.conversions.indices2radec">[docs]</a><span class="k">def</span> <span class="nf">indices2radec</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span><span class="n">nside</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts healpy indeces to RA DEC</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    indices: np.array</span>
<span class="sd">        Healpy indices</span>
<span class="sd">    nside: int</span>
<span class="sd">        nside for healpy</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ra, dec: np.array</span>
<span class="sd">        arrays with RA and DEC in radians</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">theta</span><span class="p">,</span><span class="n">phi</span><span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">pix2ang</span><span class="p">(</span><span class="n">nside</span><span class="p">,</span><span class="n">indices</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">phi</span><span class="p">,</span> <span class="n">xp</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="o">-</span><span class="n">theta</span></div>

<div class="viewcode-block" id="M2m"><a class="viewcode-back" href="../../icarogw.html#icarogw.conversions.M2m">[docs]</a><span class="k">def</span> <span class="nf">M2m</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">dl</span><span class="p">,</span><span class="n">kcorr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts Absolute bolometric magnitude to apparent magnitude</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    M: xp.array</span>
<span class="sd">        Absolute bolometric magnitude</span>
<span class="sd">    dl: xp.array</span>
<span class="sd">        Luminosity distance in Mpc</span>
<span class="sd">    kcorr: xp.array</span>
<span class="sd">        K-correction, we suggest to use the kcorr class</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    m: xp.array</span>
<span class="sd">        Apparent magnitude</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Note that the distance is Mpc here. See Eq. 2 of https://arxiv.org/abs/astro-ph/0210394</span>
    <span class="n">dist_modulus</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">xp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dl</span><span class="p">)</span><span class="o">+</span><span class="mf">25.</span>
    <span class="k">return</span> <span class="n">M</span><span class="o">+</span><span class="n">dist_modulus</span><span class="o">+</span><span class="n">kcorr</span></div>

<div class="viewcode-block" id="m2M"><a class="viewcode-back" href="../../icarogw.html#icarogw.conversions.m2M">[docs]</a><span class="k">def</span> <span class="nf">m2M</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">dl</span><span class="p">,</span><span class="n">kcorr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts apparent magnitude to Absolute bolometric magnitude</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m: xp.array</span>
<span class="sd">        apparebt magnitude</span>
<span class="sd">    dl: xp.array</span>
<span class="sd">        Luminosity distance in Mpc</span>
<span class="sd">    kcorr: xp.array</span>
<span class="sd">        K-correction, we suggest to use the kcorr class</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    M: xp.array</span>
<span class="sd">        Absolute bolometric magnitude</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Note that the distance is Mpc here. See Eq. 2 of https://arxiv.org/abs/astro-ph/0210394</span>
    <span class="n">dist_modulus</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">xp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dl</span><span class="p">)</span><span class="o">+</span><span class="mf">25.</span>
    <span class="k">return</span> <span class="n">m</span><span class="o">-</span><span class="n">dist_modulus</span><span class="o">-</span><span class="n">kcorr</span></div>

<div class="viewcode-block" id="source2detector"><a class="viewcode-back" href="../../icarogw.html#icarogw.conversions.source2detector">[docs]</a><span class="k">def</span> <span class="nf">source2detector</span><span class="p">(</span><span class="n">mass1_source</span><span class="p">,</span><span class="n">mass2_source</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">cosmology</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts from Source frame to detector frame quantities</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mass1_source: xp.array</span>
<span class="sd">        Source mass of the primary</span>
<span class="sd">    mass2_source: xp.array</span>
<span class="sd">        Source mass of the secondary</span>
<span class="sd">    z: xp.array</span>
<span class="sd">        Redshift of the object</span>
<span class="sd">    cosmology: class</span>
<span class="sd">        Cosmology class from the cosmology module</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Detector frame masses and luminosity distance in Mpc</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">mass1_source</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">z</span><span class="p">),</span><span class="n">mass2_source</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">z</span><span class="p">),</span><span class="n">cosmology</span><span class="o">.</span><span class="n">z2dl</span><span class="p">(</span><span class="n">z</span><span class="p">)</span></div>

<div class="viewcode-block" id="detector2source"><a class="viewcode-back" href="../../icarogw.html#icarogw.conversions.detector2source">[docs]</a><span class="k">def</span> <span class="nf">detector2source</span><span class="p">(</span><span class="n">mass1</span><span class="p">,</span><span class="n">mass2</span><span class="p">,</span><span class="n">dl</span><span class="p">,</span><span class="n">cosmology</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts from Source frame to detector frame quantities</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mass1: xp.array</span>
<span class="sd">        Detector mass of the primary</span>
<span class="sd">    mass2: xp.array</span>
<span class="sd">        Detector mass of the secondary</span>
<span class="sd">    dl: xp.array</span>
<span class="sd">        Luminosity distnce in Mpc</span>
<span class="sd">    cosmology: class</span>
<span class="sd">        Cosmology class from the cosmology module</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Source frame masses and redshift</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">z</span><span class="o">=</span><span class="n">cosmology</span><span class="o">.</span><span class="n">dl2z</span><span class="p">(</span><span class="n">dl</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mass1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">z</span><span class="p">),</span><span class="n">mass2</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">z</span><span class="p">),</span><span class="n">z</span></div>


<div class="viewcode-block" id="detector2source_jacobian"><a class="viewcode-back" href="../../icarogw.html#icarogw.conversions.detector2source_jacobian">[docs]</a><span class="k">def</span> <span class="nf">detector2source_jacobian</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">cosmology</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calculates the detector frame to source frame Jacobian d_det/d_sour</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    z: xp. arrays</span>
<span class="sd">        Redshift</span>
<span class="sd">    cosmo:  class from the cosmology module</span>
<span class="sd">        Cosmology class from the cosmology module</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">xp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">z</span><span class="p">,</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="n">cosmology</span><span class="o">.</span><span class="n">ddl_by_dz_at_z</span><span class="p">(</span><span class="n">z</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="source2detector_jacobian"><a class="viewcode-back" href="../../icarogw.html#icarogw.conversions.source2detector_jacobian">[docs]</a><span class="k">def</span> <span class="nf">source2detector_jacobian</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">cosmology</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calculates the detector frame to source frame Jacobian d_sour/d_det</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    z: xp. arrays</span>
<span class="sd">        Redshift</span>
<span class="sd">    cosmo:  class from the cosmology module</span>
<span class="sd">        Cosmology class from the cosmology module</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="mf">1.</span><span class="o">/</span><span class="n">detector2source_jacobian</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">cosmology</span><span class="p">)</span></div>
    
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Simone Mastrogiovanni.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>