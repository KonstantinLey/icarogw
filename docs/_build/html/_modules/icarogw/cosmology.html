<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>icarogw.cosmology &mdash; icarogw 2.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            icarogw
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">icarogw</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">icarogw</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">icarogw.cosmology</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for icarogw.cosmology</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">.cupy_pal</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">cumtrapz</span>
<span class="kn">import</span> <span class="nn">mpmath</span>

<span class="n">COST_C</span><span class="o">=</span> <span class="mf">299792.458</span> <span class="c1"># Speed of light in km/s</span>

<div class="viewcode-block" id="base_cosmology"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.base_cosmology">[docs]</a><span class="k">class</span> <span class="nc">base_cosmology</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">zmax</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A class to handle cosmology. Note, quantities related to comoving volume are in Gpc while quantities related to distances </span>
<span class="sd">        in Mpc.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        zmax: float</span>
<span class="sd">            initialize the cosmology up to zmax</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zmax</span><span class="o">=</span><span class="n">zmax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_cpu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zmax</span><span class="p">),</span><span class="mi">2500</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_gpu</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zmax</span><span class="p">),</span><span class="mi">2500</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">log10_z_gpu</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_gpu</span><span class="p">)</span>
        
<div class="viewcode-block" id="base_cosmology.z2dl"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.base_cosmology.z2dl">[docs]</a>    <span class="k">def</span> <span class="nf">z2dl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Converts redshift to luminosity distance</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        z: xp.array</span>
<span class="sd">            Redshift</span>
<span class="sd">        </span>
<span class="sd">        Reutrns</span>
<span class="sd">        -------</span>
<span class="sd">        dl: xp.array</span>
<span class="sd">            luminosity distance in Mpc</span>
<span class="sd">        &#39;&#39;&#39;</span> 
        <span class="n">origin</span><span class="o">=</span><span class="n">z</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">ravelled</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
        <span class="n">interpo</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">ravelled</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log10_z_gpu</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log10_dl_at_z</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">interpo</span><span class="p">,</span><span class="n">origin</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="base_cosmology.z2Vc"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.base_cosmology.z2Vc">[docs]</a>    <span class="k">def</span> <span class="nf">z2Vc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Converts redshift to luminosity distance</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        z: xp.array</span>
<span class="sd">            Redshift</span>
<span class="sd">        </span>
<span class="sd">        Reutrns</span>
<span class="sd">        -------</span>
<span class="sd">        dl: xp.array</span>
<span class="sd">            luminosity distance in Mpc</span>
<span class="sd">        &#39;&#39;&#39;</span> 
        <span class="n">origin</span><span class="o">=</span><span class="n">z</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">ravelled</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
        <span class="n">interpo</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">ravelled</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log10_z_gpu</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log10_Vc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">interpo</span><span class="p">,</span><span class="n">origin</span><span class="p">)</span></div>
        
        
<div class="viewcode-block" id="base_cosmology.dl2z"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.base_cosmology.dl2z">[docs]</a>    <span class="k">def</span> <span class="nf">dl2z</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dl</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Converts luminosity distance to redshift</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dl: xp.array</span>
<span class="sd">            luminosity distance in Mpc</span>
<span class="sd">        </span>
<span class="sd">        Reutrns</span>
<span class="sd">        -------</span>
<span class="sd">        z: xp.array</span>
<span class="sd">            redshift</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">origin</span><span class="o">=</span><span class="n">dl</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">ravelled</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dl</span><span class="p">))</span>
        <span class="n">interpo</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">ravelled</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log10_dl_at_z</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log10_z_gpu</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">interpo</span><span class="p">,</span><span class="n">origin</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="base_cosmology.dVc_by_dzdOmega_at_z"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.base_cosmology.dVc_by_dzdOmega_at_z">[docs]</a>    <span class="k">def</span> <span class="nf">dVc_by_dzdOmega_at_z</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculates the differential of the comoving volume per sterdian at a given redshift</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        z: xp.array</span>
<span class="sd">            Redshift</span>
<span class="sd">        </span>
<span class="sd">        Reutrns</span>
<span class="sd">        -------</span>
<span class="sd">        dVc_by_dzdOmega: xp.array</span>
<span class="sd">            comoving volume per sterdian at a given redshift in Gpc3std-1</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">origin</span><span class="o">=</span><span class="n">z</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">ravelled</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
        <span class="n">interpo</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">ravelled</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log10_z_gpu</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log10_dVc_dzdOmega</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">interpo</span><span class="p">,</span><span class="n">origin</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="base_cosmology.ddl_by_dz_at_z"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.base_cosmology.ddl_by_dz_at_z">[docs]</a>    <span class="k">def</span> <span class="nf">ddl_by_dz_at_z</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculates the differential of the luminosity distance at given redshift</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        z: xp.array</span>
<span class="sd">            Redshift</span>
<span class="sd">        </span>
<span class="sd">        Reutrns</span>
<span class="sd">        -------</span>
<span class="sd">        ddl_by_dz: xp.array</span>
<span class="sd">            differential of the luminosity distance in Mpc</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">origin</span><span class="o">=</span><span class="n">z</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">ravelled</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
        <span class="n">interpo</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">ravelled</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log10_z_gpu</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log10_ddl_by_dz</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">interpo</span><span class="p">,</span><span class="n">origin</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="base_cosmology.sample_comoving_volume"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.base_cosmology.sample_comoving_volume">[docs]</a>    <span class="k">def</span> <span class="nf">sample_comoving_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Nsamp</span><span class="p">,</span><span class="n">zmin</span><span class="p">,</span><span class="n">zmax</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Samples uniform in the comoving volume</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Nsamp: int</span>
<span class="sd">            Number of samples to draw</span>
<span class="sd">        zmin, zmax: float</span>
<span class="sd">            Minimum and maxmium redshift at which to draw</span>
<span class="sd">        </span>
<span class="sd">        Reutrns</span>
<span class="sd">        -------</span>
<span class="sd">        z_samples: xp.array</span>
<span class="sd">            Distribution in z uniform in comoving volume</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">zproxy</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">zmin</span><span class="p">,</span><span class="n">zmax</span><span class="p">,</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dVc_by_dzdOmega_at_z</span><span class="p">(</span><span class="n">zproxy</span><span class="p">)</span>
        <span class="n">cdf</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span><span class="o">/</span><span class="n">prob</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">cdf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mf">0.</span>
        <span class="n">cdf_samps</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">Nsamp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xp</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">cdf_samps</span><span class="p">,</span><span class="n">cdf</span><span class="p">,</span><span class="n">zproxy</span><span class="p">)</span></div></div>
    

<div class="viewcode-block" id="astropycosmology"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.astropycosmology">[docs]</a><span class="k">class</span> <span class="nc">astropycosmology</span><span class="p">(</span><span class="n">base_cosmology</span><span class="p">):</span>
<div class="viewcode-block" id="astropycosmology.build_cosmology"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.astropycosmology.build_cosmology">[docs]</a>    <span class="k">def</span>  <span class="nf">build_cosmology</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">astropy_cosmo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Construct the cosmology</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        astropy_cosmo: Astropy.cosmology class</span>
<span class="sd">            initialize the cosmology up to zmax</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">astropy_cosmo</span><span class="o">=</span><span class="n">astropy_cosmo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">little_h</span><span class="o">=</span><span class="n">astropy_cosmo</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="o">/</span><span class="mf">100.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log10_dVc_dzdOmega</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np2cp</span><span class="p">(</span><span class="n">astropy_cosmo</span><span class="o">.</span><span class="n">differential_comoving_volume</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_cpu</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">))</span><span class="o">-</span><span class="mf">9.</span> <span class="c1"># Conversion from Mpc to Gpc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log10_Vc</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np2cp</span><span class="p">(</span><span class="n">astropy_cosmo</span><span class="o">.</span><span class="n">comoving_volume</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_cpu</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">))</span><span class="o">-</span><span class="mf">9.</span> <span class="c1"># Conversion to Gpc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log10_dl_at_z</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np2cp</span><span class="p">(</span><span class="n">astropy_cosmo</span><span class="o">.</span><span class="n">luminosity_distance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_cpu</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log10_ddl_by_dz</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">log10</span><span class="p">((</span><span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log10_dl_at_z</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">z_gpu</span><span class="p">))</span><span class="o">+</span><span class="n">COST_C</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">z_gpu</span><span class="p">)</span><span class="o">/</span><span class="n">np2cp</span><span class="p">(</span><span class="n">astropy_cosmo</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_cpu</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">))</span></div></div>
        
        
<div class="viewcode-block" id="extraD_astropycosmology"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.extraD_astropycosmology">[docs]</a><span class="k">class</span> <span class="nc">extraD_astropycosmology</span><span class="p">(</span><span class="n">astropycosmology</span><span class="p">):</span>
<div class="viewcode-block" id="extraD_astropycosmology.build_cosmology"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.extraD_astropycosmology.build_cosmology">[docs]</a>    <span class="k">def</span> <span class="nf">build_cosmology</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">astropy_cosmo</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">Rc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Construct the cosmology</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        astropy_cosmo: Astropy.cosmology class</span>
<span class="sd">            initialize the cosmology up to zmax</span>
<span class="sd">        D,n,Rc: float</span>
<span class="sd">            The GR modification parameters as described in Eq. 2.22 of https://arxiv.org/pdf/2109.08748.pdf</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build_cosmology</span><span class="p">(</span><span class="n">astropy_cosmo</span><span class="p">)</span>
        <span class="n">dlem</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log10_dl_at_z</span><span class="p">)</span>
        <span class="n">dlbydz_em</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log10_ddl_by_dz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log10_dl_at_z</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dlem</span><span class="o">*</span><span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">dlem</span><span class="o">/</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">z_gpu</span><span class="p">)</span><span class="o">*</span><span class="n">Rc</span><span class="p">),</span><span class="n">n</span><span class="p">),(</span><span class="n">D</span><span class="o">-</span><span class="mf">4.</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">)))</span>
        <span class="n">Afa</span><span class="o">=</span><span class="mf">1.</span><span class="o">+</span><span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">dlem</span><span class="o">/</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">z_gpu</span><span class="p">)</span><span class="o">*</span><span class="n">Rc</span><span class="p">),</span><span class="n">n</span><span class="p">)</span>
        <span class="n">expo</span><span class="o">=</span><span class="p">(</span><span class="n">D</span><span class="o">-</span><span class="mf">4.</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
        <span class="c1"># We put the absolute value for the Jacobian (because this is needed for probabilities)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log10_ddl_by_dz</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">Afa</span><span class="p">,</span><span class="n">expo</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dlbydz_em</span><span class="o">+</span><span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">dlem</span><span class="o">/</span><span class="n">Rc</span><span class="p">,</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">expo</span><span class="o">*</span><span class="n">n</span><span class="o">/</span><span class="n">Afa</span><span class="p">)</span><span class="o">*</span>\
            <span class="p">(</span><span class="n">dlbydz_em</span><span class="o">/</span><span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">z_gpu</span><span class="p">,</span><span class="n">n</span><span class="p">)</span><span class="o">-</span><span class="n">dlem</span><span class="o">/</span><span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">z_gpu</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mf">1.</span><span class="p">)))))</span></div></div>

<div class="viewcode-block" id="cM_astropycosmology"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.cM_astropycosmology">[docs]</a><span class="k">class</span> <span class="nc">cM_astropycosmology</span><span class="p">(</span><span class="n">astropycosmology</span><span class="p">):</span>
<div class="viewcode-block" id="cM_astropycosmology.build_cosmology"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.cM_astropycosmology.build_cosmology">[docs]</a>    <span class="k">def</span> <span class="nf">build_cosmology</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">astropy_cosmo</span><span class="p">,</span><span class="n">cM</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Construct the cosmology</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        astropy_cosmo: Astropy.cosmology class</span>
<span class="sd">            initialize the cosmology up to zmax</span>
<span class="sd">        D,n,Rc: float</span>
<span class="sd">            The GR modification parameters as described in Eq. 2.22 of https://arxiv.org/pdf/2109.08748.pdf</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build_cosmology</span><span class="p">(</span><span class="n">astropy_cosmo</span><span class="p">)</span>
        <span class="n">dlem</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log10_dl_at_z</span><span class="p">)</span>
        <span class="n">dlbydz_em</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log10_ddl_by_dz</span><span class="p">)</span>
        <span class="c1"># Implementation of the running Planck mass model general case as described in the overleaf https://www.overleaf.com/project/62330c2859bb3c2a5982c2b6</span>
        <span class="c1"># Define array for numerical integration</span>
        <span class="n">ZforI</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_cpu</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">z_cpu</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">z_cpu</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">ZforI</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">ZforI</span><span class="p">)</span>
        <span class="n">Zhalfbin</span><span class="o">=</span><span class="p">(</span><span class="n">ZforI</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">ZforI</span><span class="p">[</span><span class="mi">1</span><span class="p">::])</span><span class="o">*</span><span class="mf">0.5</span>
        <span class="n">Integrandhalfin</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">Zhalfbin</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">astropy_cosmo</span><span class="o">.</span><span class="n">efunc</span><span class="p">(</span><span class="n">Zhalfbin</span><span class="p">),</span><span class="mf">2.</span><span class="p">))</span>
        <span class="n">Integrand</span><span class="o">=</span><span class="n">np2cp</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">z_cpu</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">astropy_cosmo</span><span class="o">.</span><span class="n">efunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_cpu</span><span class="p">),</span><span class="mf">2.</span><span class="p">)))</span>
        <span class="n">Integral</span><span class="o">=</span><span class="n">np2cp</span><span class="p">(</span><span class="n">cumtrapz</span><span class="p">(</span><span class="n">Integrandhalfin</span><span class="p">,</span><span class="n">Zhalfbin</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log10_dl_at_z</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dlem</span><span class="o">*</span><span class="n">xp</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mf">0.5</span><span class="o">*</span><span class="n">cM</span><span class="p">)</span><span class="o">*</span><span class="n">Integral</span><span class="p">))</span>
        <span class="n">exp_factor</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">cM</span><span class="o">*</span><span class="n">Integral</span><span class="p">)</span>
        <span class="c1"># We put the absolute value for the Jacobian (because this is needed for probabilities)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log10_ddl_by_dz</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">exp_factor</span><span class="o">*</span><span class="n">dlbydz_em</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dlem</span><span class="o">*</span><span class="n">cM</span><span class="o">*</span><span class="n">exp_factor</span><span class="o">*</span><span class="n">Integrand</span><span class="p">))</span></div></div>
        
        
    
        
        
<div class="viewcode-block" id="Xi0_astropycosmology"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.Xi0_astropycosmology">[docs]</a><span class="k">class</span> <span class="nc">Xi0_astropycosmology</span><span class="p">(</span><span class="n">astropycosmology</span><span class="p">):</span>
<div class="viewcode-block" id="Xi0_astropycosmology.build_cosmology"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.Xi0_astropycosmology.build_cosmology">[docs]</a>    <span class="k">def</span>  <span class="nf">build_cosmology</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">astropy_cosmo</span><span class="p">,</span><span class="n">Xi0</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Construct the cosmology</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        astropy_cosmo: Astropy.cosmology class</span>
<span class="sd">            initialize the cosmology up to zmax</span>
<span class="sd">        Xi0, n: float</span>
<span class="sd">            The GR modification parameters as described in Eq. 2.31 of https://arxiv.org/pdf/1906.01593</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build_cosmology</span><span class="p">(</span><span class="n">astropy_cosmo</span><span class="p">)</span>
        <span class="n">dlem</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log10_dl_at_z</span><span class="p">)</span>
        <span class="n">dlbydz_em</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log10_ddl_by_dz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log10_dl_at_z</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dlem</span><span class="o">*</span><span class="p">(</span><span class="n">Xi0</span><span class="o">+</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">Xi0</span><span class="p">)</span><span class="o">*</span><span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">z_gpu</span><span class="p">,</span><span class="o">-</span><span class="n">n</span><span class="p">)))</span>
        <span class="c1"># We put the absolute value for the Jacobian (because this is needed for probabilities)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log10_ddl_by_dz</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dlbydz_em</span><span class="o">*</span><span class="p">(</span><span class="n">Xi0</span><span class="o">+</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">Xi0</span><span class="p">)</span><span class="o">*</span><span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">z_gpu</span><span class="p">,</span><span class="o">-</span><span class="n">n</span><span class="p">))</span><span class="o">-</span><span class="n">dlem</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">Xi0</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">z_gpu</span><span class="p">,</span><span class="o">-</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span></div></div>
        
<div class="viewcode-block" id="alphalog_astropycosmology"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.alphalog_astropycosmology">[docs]</a><span class="k">class</span> <span class="nc">alphalog_astropycosmology</span><span class="p">(</span><span class="n">astropycosmology</span><span class="p">):</span>
<div class="viewcode-block" id="alphalog_astropycosmology.build_cosmology"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.alphalog_astropycosmology.build_cosmology">[docs]</a>    <span class="k">def</span>  <span class="nf">build_cosmology</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">astropy_cosmo</span><span class="p">,</span><span class="n">alphalog_1</span><span class="p">,</span> <span class="n">alphalog_2</span><span class="p">,</span> <span class="n">alphalog_3</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Construct the cosmology</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        astropy_cosmo: Astropy.cosmology class</span>
<span class="sd">            initialize the cosmology up to zmax</span>
<span class="sd">        alphalog_1, alphalog_2, alphalog_3: float</span>
<span class="sd">            Implementation of the logarithm phenomenological dimension model proposed by the CosmologyTGR group</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build_cosmology</span><span class="p">(</span><span class="n">astropy_cosmo</span><span class="p">)</span>
        <span class="n">dlem</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log10_dl_at_z</span><span class="p">)</span>
        <span class="n">dlbydz_em</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log10_ddl_by_dz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log10_dl_at_z</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dlem</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">alphalog_1</span><span class="o">*</span><span class="n">xp</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_gpu</span><span class="p">)</span><span class="o">+</span>\
                                <span class="n">alphalog_2</span><span class="o">*</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_gpu</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span>\
                                <span class="n">alphalog_3</span><span class="o">*</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_gpu</span><span class="p">)</span><span class="o">**</span><span class="mf">3.</span><span class="p">)))</span>        
        <span class="n">part1</span> <span class="o">=</span> <span class="n">dlbydz_em</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">alphalog_1</span><span class="o">*</span><span class="n">xp</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_gpu</span><span class="p">)</span><span class="o">+</span> \
                                        <span class="n">alphalog_2</span><span class="o">*</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_gpu</span><span class="p">))</span><span class="o">**</span><span class="mf">2.</span><span class="o">+</span>\
                                        <span class="n">alphalog_3</span><span class="o">*</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_gpu</span><span class="p">))</span><span class="o">**</span><span class="mf">3.</span><span class="p">)</span>
        <span class="n">part2</span> <span class="o">=</span> <span class="p">(</span><span class="n">dlem</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">z_gpu</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">alphalog_1</span><span class="o">+</span><span class="n">alphalog_2</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="n">xp</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_gpu</span><span class="p">)</span><span class="o">+</span>\
                      <span class="n">alphalog_3</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_gpu</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span><span class="p">))</span>
        <span class="c1"># We put the absolute value for the Jacobian (because this is needed for probabilities)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log10_ddl_by_dz</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">part1</span> <span class="o">+</span> <span class="n">part2</span><span class="p">))</span></div></div>

    
<div class="viewcode-block" id="galaxy_MF"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.galaxy_MF">[docs]</a><span class="k">class</span> <span class="nc">galaxy_MF</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">band</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Mmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Mmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Mstar</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">phistar</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A class to handle the Schechter function in absolute magnitude</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        band: string</span>
<span class="sd">            W1, K or bJ band. Others are not implemented</span>
<span class="sd">        Mmin, Mmax,Mstar,alpha,phistar: float</span>
<span class="sd">            Minimum, maximum absolute magnitude. Knee-absolute magnitude (for h=1), Powerlaw factor and galaxy number density per Gpc-3 </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Note, we convert phistar to Gpc-3</span>
        <span class="k">if</span> <span class="n">band</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Mmin</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Mmax</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Mstar</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">phistar</span><span class="o">=</span><span class="n">Mmin</span><span class="p">,</span><span class="n">Mmax</span><span class="p">,</span><span class="n">Mstar</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">phistar</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">band</span><span class="o">==</span><span class="s1">&#39;W1&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Mmin</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Mmax</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Mstar</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">phistar</span><span class="o">=-</span><span class="mi">28</span><span class="p">,</span> <span class="o">-</span><span class="mf">16.6</span><span class="p">,</span> <span class="o">-</span><span class="mf">24.09</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.12</span><span class="p">,</span> <span class="mf">1.45e-2</span><span class="o">*</span><span class="mf">1e9</span>
            <span class="k">elif</span> <span class="n">band</span><span class="o">==</span><span class="s1">&#39;bJ&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Mmin</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Mmax</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Mstar</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">phistar</span><span class="o">=-</span><span class="mf">22.00</span><span class="p">,</span> <span class="o">-</span><span class="mf">16.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">19.66</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.21</span><span class="p">,</span> <span class="mf">1.61e-2</span><span class="o">*</span><span class="mf">1e9</span>
            <span class="k">elif</span> <span class="n">band</span><span class="o">==</span><span class="s1">&#39;K&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Mmin</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Mmax</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Mstar</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">phistar</span><span class="o">=-</span><span class="mf">27.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">19.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">23.39</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.09</span><span class="p">,</span> <span class="mf">1.16e-2</span><span class="o">*</span><span class="mf">1e9</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Band not known&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="galaxy_MF.build_MF"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.galaxy_MF.build_MF">[docs]</a>    <span class="k">def</span> <span class="nf">build_MF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cosmology</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Build the Magnitude function</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cosmology: cosmology class</span>
<span class="sd">            cosmology class from the cosmology module</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cosmology</span><span class="o">=</span><span class="n">cosmology</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Mstarobs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Mstar</span><span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">cosmology</span><span class="o">.</span><span class="n">little_h</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Mminobs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Mmin</span><span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">cosmology</span><span class="o">.</span><span class="n">little_h</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Mmaxobs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Mmax</span><span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">cosmology</span><span class="o">.</span><span class="n">little_h</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">phistarobs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phistar</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">cosmology</span><span class="o">.</span><span class="n">little_h</span><span class="p">,</span><span class="mf">3.</span><span class="p">)</span>
        <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="mf">0.4</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mstarobs</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Mminobs</span><span class="p">))</span>
        <span class="n">xmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="mf">0.4</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mstarobs</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Mmaxobs</span><span class="p">))</span>
        <span class="c1"># Check if you need to replace this with a numerical integral.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phistarobs</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">mpmath</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">xmax</span><span class="p">))</span></div>

<div class="viewcode-block" id="galaxy_MF.log_evaluate"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.galaxy_MF.log_evaluate">[docs]</a>    <span class="k">def</span> <span class="nf">log_evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">M</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Evluates the log of the Sch function</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        M: xp.array</span>
<span class="sd">            Absolute magnitude</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        log of the Sch function</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">toret</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">0.4</span><span class="o">*</span><span class="n">xp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">phistarobs</span><span class="p">)</span><span class="o">+</span> \
        <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.4</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mstarobs</span><span class="o">-</span><span class="n">M</span><span class="p">))</span><span class="o">*</span><span class="n">xp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">10.</span><span class="p">)</span><span class="o">-</span><span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="mf">0.4</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mstarobs</span><span class="o">-</span><span class="n">M</span><span class="p">))</span>
        <span class="n">toret</span><span class="p">[(</span><span class="n">M</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">Mminobs</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">M</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">Mmaxobs</span><span class="p">)]</span><span class="o">=-</span><span class="n">xp</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">return</span> <span class="n">toret</span></div>

<div class="viewcode-block" id="galaxy_MF.log_pdf"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.galaxy_MF.log_pdf">[docs]</a>    <span class="k">def</span> <span class="nf">log_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">M</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Evluates the log of the Sch function as pdf</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        M: xp.array</span>
<span class="sd">            Absolute magnitude</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        log of the Sch function as pdf</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_evaluate</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">-</span><span class="n">xp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">)</span></div>

<div class="viewcode-block" id="galaxy_MF.pdf"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.galaxy_MF.pdf">[docs]</a>    <span class="k">def</span> <span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">M</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Evluates the Sch as pdf</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        M: xp.array</span>
<span class="sd">            Absolute magnitude</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        log of the Sch as pdf</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">xp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_pdf</span><span class="p">(</span><span class="n">M</span><span class="p">))</span></div>

<div class="viewcode-block" id="galaxy_MF.evaluate"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.galaxy_MF.evaluate">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">M</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Evluates the Sch as pdf</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        M: xp.array</span>
<span class="sd">            Absolute magnitude</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Sch function in Gpc-3</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">xp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_evaluate</span><span class="p">(</span><span class="n">M</span><span class="p">))</span></div>

<div class="viewcode-block" id="galaxy_MF.sample"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.galaxy_MF.sample">[docs]</a>    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Samples from the pdf</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        N: int</span>
<span class="sd">            Number of samples to generate</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Samples: xp.array</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">sarray</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mminobs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Mmaxobs</span><span class="p">,</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">cdfeval</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">sarray</span><span class="p">))</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">sarray</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">cdfeval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mf">0.</span>
        <span class="n">randomcdf</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xp</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">randomcdf</span><span class="p">,</span><span class="n">cdfeval</span><span class="p">,</span><span class="n">sarray</span><span class="p">,</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Mminobs</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Mmaxobs</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="galaxy_MF.build_effective_number_density_interpolant"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.galaxy_MF.build_effective_number_density_interpolant">[docs]</a>    <span class="k">def</span> <span class="nf">build_effective_number_density_interpolant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">epsilon</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;This method build the number density interpolant. This is defined as the integral from the Schecter function faint end to a value M_thr for the Schechter</span>
<span class="sd">        function times the luminosity weights. Note that this integral is done in x=Mstar-M, which is a cosmology independent quantity.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        epsilon: float</span>
<span class="sd">            Powerlaw slope for the luminosity weights</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">minv</span><span class="p">,</span><span class="n">maxv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Mmin</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Mmax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="o">=</span><span class="n">epsilon</span>
        <span class="n">Mvector_interpolant</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">minv</span><span class="p">,</span><span class="n">maxv</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">effective_density_interpolant</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">Mvector_interpolant</span><span class="p">)</span>
        <span class="n">xmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="mf">0.4</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mstar</span><span class="o">-</span><span class="n">maxv</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Mvector_interpolant</span><span class="p">)):</span>
            <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="mf">0.4</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mstar</span><span class="o">-</span><span class="n">Mvector_interpolant</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">effective_density_interpolant</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">mpmath</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">epsilon</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">xmax</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">effective_density_interpolant</span><span class="o">=</span><span class="n">np2cp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">effective_density_interpolant</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xvector_interpolant</span><span class="o">=</span><span class="n">np2cp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mstar</span><span class="o">-</span><span class="n">Mvector_interpolant</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>
        
<div class="viewcode-block" id="galaxy_MF.background_effective_galaxy_density"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.galaxy_MF.background_effective_galaxy_density">[docs]</a>    <span class="k">def</span> <span class="nf">background_effective_galaxy_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Mthr</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Returns the effective galaxy density, i.e. dN_{gal,eff}/dVc, the effective number is given by the luminosity weights.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Mthr: xp.array</span>
<span class="sd">            Absolute magnitude threshold (faint) used to compute the integral</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">origin</span><span class="o">=</span><span class="n">Mthr</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">ravelled</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mstarobs</span><span class="o">-</span><span class="n">Mthr</span><span class="p">)</span>
        <span class="n">outp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phistarobs</span><span class="o">*</span><span class="n">xp</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">ravelled</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">xvector_interpolant</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">effective_density_interpolant</span>
                           <span class="p">,</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">effective_density_interpolant</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">effective_density_interpolant</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">xp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">outp</span><span class="p">,</span><span class="n">origin</span><span class="p">)</span></div></div>
    
<div class="viewcode-block" id="kcorr"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.kcorr">[docs]</a><span class="k">class</span> <span class="nc">kcorr</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">band</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A class to handle K-corrections</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        band: string</span>
<span class="sd">            W1, K or bJ band. Others are not implemented</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">band</span><span class="o">=</span><span class="n">band</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">band</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;W1&#39;</span><span class="p">,</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="s1">&#39;bJ&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Band not known, please use W1 or K or bJ&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Evaluates the K-corrections at a given redshift, See Eq. 2 of https://arxiv.org/abs/astro-ph/0210394</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        z: xp.array</span>
<span class="sd">            Redshift</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        k_corrections: xp.array</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">band</span> <span class="o">==</span> <span class="s1">&#39;W1&#39;</span><span class="p">:</span>
            <span class="n">k_corr</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="mf">4.44e-2</span><span class="o">+</span><span class="mf">2.67</span><span class="o">*</span><span class="n">z</span><span class="o">+</span><span class="mf">1.33</span><span class="o">*</span><span class="p">(</span><span class="n">z</span><span class="o">**</span><span class="mf">2.</span><span class="p">)</span><span class="o">-</span><span class="mf">1.59</span><span class="o">*</span><span class="p">(</span><span class="n">z</span><span class="o">**</span><span class="mf">3.</span><span class="p">))</span> <span class="c1">#From Maciej email</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">band</span> <span class="o">==</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span>
            <span class="c1"># https://iopscience.iop.org/article/10.1086/322488/pdf 4th page lhs</span>
            <span class="n">to_ret</span><span class="o">=-</span><span class="mf">6.0</span><span class="o">*</span><span class="n">xp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">z</span><span class="p">)</span>
            <span class="n">to_ret</span><span class="p">[</span><span class="n">z</span><span class="o">&gt;</span><span class="mf">0.3</span><span class="p">]</span><span class="o">=-</span><span class="mf">6.0</span><span class="o">*</span><span class="n">xp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">k_corr</span><span class="o">=-</span><span class="mf">6.0</span><span class="o">*</span><span class="n">xp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">z</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">band</span> <span class="o">==</span> <span class="s1">&#39;bJ&#39;</span><span class="p">:</span>
            <span class="c1"># Fig 5 caption from https://arxiv.org/pdf/astro-ph/0111011.pdf</span>
            <span class="c1"># Note that these corrections also includes evolution corrections</span>
            <span class="n">k_corr</span><span class="o">=</span><span class="p">(</span><span class="n">z</span><span class="o">+</span><span class="mi">6</span><span class="o">*</span><span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="mf">2.</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mf">15.</span><span class="o">*</span><span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="mf">3.</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">k_corr</span></div>
        
<div class="viewcode-block" id="basic_redshift_rate"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.basic_redshift_rate">[docs]</a><span class="k">class</span> <span class="nc">basic_redshift_rate</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Super class for the redshift rate</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="basic_redshift_rate.evaluate"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.basic_redshift_rate.evaluate">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; Returns the rate</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        z: xp.array</span>
<span class="sd">            Redshift  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">xp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_evaluate</span><span class="p">(</span><span class="n">z</span><span class="p">))</span></div></div>
    
<div class="viewcode-block" id="powerlaw_rate"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.powerlaw_rate">[docs]</a><span class="k">class</span> <span class="nc">powerlaw_rate</span><span class="p">(</span><span class="n">basic_redshift_rate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class for a power-law redshift rate</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gamma</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span>
<div class="viewcode-block" id="powerlaw_rate.log_evaluate"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.powerlaw_rate.log_evaluate">[docs]</a>    <span class="k">def</span> <span class="nf">log_evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">*</span><span class="n">xp</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">z</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="md_rate"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.md_rate">[docs]</a><span class="k">class</span> <span class="nc">md_rate</span><span class="p">(</span><span class="n">basic_redshift_rate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class for a MD like redshift rate</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gamma</span><span class="p">,</span><span class="n">kappa</span><span class="p">,</span><span class="n">zp</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span><span class="o">=</span><span class="n">kappa</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">=</span><span class="n">zp</span>
<div class="viewcode-block" id="md_rate.log_evaluate"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.md_rate.log_evaluate">[docs]</a>    <span class="k">def</span> <span class="nf">log_evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">xp</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="p">,</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">kappa</span><span class="p">))</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">*</span><span class="n">xp</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">-</span><span class="n">xp</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">power</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">z</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kappa</span><span class="p">))</span></div></div>


    
<div class="viewcode-block" id="basic_absM_rate"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.basic_absM_rate">[docs]</a><span class="k">class</span> <span class="nc">basic_absM_rate</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Super class for the redshift rate</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="basic_absM_rate.evaluate"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.basic_absM_rate.evaluate">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sch</span><span class="p">,</span><span class="n">M</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; Returns the rate</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sch: Schechter class</span>
<span class="sd">        M: xp.array</span>
<span class="sd">            Redshift  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">xp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_evaluate</span><span class="p">(</span><span class="n">sch</span><span class="p">,</span><span class="n">M</span><span class="p">))</span></div></div>

<div class="viewcode-block" id="log_powerlaw_absM_rate"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.log_powerlaw_absM_rate">[docs]</a><span class="k">class</span> <span class="nc">log_powerlaw_absM_rate</span><span class="p">(</span><span class="n">basic_absM_rate</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">epsilon</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="o">=</span><span class="n">epsilon</span>
<div class="viewcode-block" id="log_powerlaw_absM_rate.log_evaluate"><a class="viewcode-back" href="../../icarogw.html#icarogw.cosmology.log_powerlaw_absM_rate.log_evaluate">[docs]</a>    <span class="k">def</span> <span class="nf">log_evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sch</span><span class="p">,</span><span class="n">M</span><span class="p">):</span>
        <span class="n">toret</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="o">*</span><span class="mf">0.4</span><span class="o">*</span><span class="p">(</span><span class="n">sch</span><span class="o">.</span><span class="n">Mstarobs</span><span class="o">-</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">xp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="c1"># Note Galaxies fainter than the Schechter limit are assumed to have CBC rate 0.</span>
        <span class="c1"># Note Galaxies brighter are kept even if incosistent with Schechter limit </span>
        <span class="n">toret</span><span class="p">[(</span><span class="n">M</span><span class="o">&gt;</span><span class="n">sch</span><span class="o">.</span><span class="n">Mmaxobs</span><span class="p">)]</span><span class="o">=-</span><span class="n">xp</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">return</span> <span class="n">toret</span></div></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Simone Mastrogiovanni.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>